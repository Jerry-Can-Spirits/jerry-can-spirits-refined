---
// src/layouts/MainLayout.astro
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import AgeGate from '../components/AgeGate.astro';
import Signup from '../components/Signup.astro';

// Accept props for SEO and page configuration
const { 
  title = "Jerry Can Spirits", 
  description = "Premium spirits for your adventures. Discover our collection of carefully crafted spirits designed for the modern adventurer.",
  keywords = "spirits, adventure, premium alcohol, Jerry Can Spirits",
  ogImage = "/og-image.jpg",
  noindex = false,
  canonicalURL = Astro.url.href
} = Astro.props;

// Build the page title
const pageTitle = title === "Jerry Can Spirits" ? title : `${title} | Jerry Can Spirits`;

// Check if we're on the homepage
const isHomepage = Astro.url.pathname === '/';

// Get current year for copyright
const currentYear = new Date().getFullYear();
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    
    <!-- Prevent iOS phone number detection -->
    <meta name="format-detection" content="telephone=no" />
    
    <!-- Theme color for browser chrome -->
    <meta name="theme-color" content="#2A2F1D" />
    
    <!-- SEO Meta Tags -->
    <title>{pageTitle}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:site_name" content="Jerry Can Spirits" />
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://static.klaviyo.com" />
    
    <!-- Google Fonts with display swap for better performance -->
    <link 
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@400;700&display=swap" 
      rel="stylesheet" 
    />
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Jerry Can Spirits",
        "url": "https://jerrycanspirits.co.uk",
        "logo": "https://jerrycanspirits.co.uk/logo-primary.png",
        "sameAs": [
          "https://www.facebook.com/profile.php?id=61579347508647",
          "https://www.instagram.com/jerrycanspirits"
          "https://www.tiktok.com/@your-tiktok-handle"
        ],
        "contactPoint": {
          "@type": "ContactPoint",
          "contactType": "customer service",
          "url": "https://jerrycanspirits.co.uk/contact"
        }
      }
    </script>
  </head>
  
  <body class:list={{ homepage: isHomepage }}>
    <!-- Age verification gate -->
    <AgeGate />
    
    <!-- Site header with navigation -->
    <Header homepage={isHomepage} />
    
    <!-- Main content area -->
    <main data-homepage={isHomepage}>
      <slot />
    </main>
    
    <!-- Site footer -->
    <Footer />
    
    <!-- Theme Toggle Button (Optional - remove if not wanted) -->
    <button 
      class="theme-toggle" 
      onclick="toggleTheme()" 
      aria-label="Toggle dark mode"
      title="Toggle dark mode"
    >
      <svg class="sun-icon" style="display: none;" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
      </svg>
      <svg class="moon-icon" fill="currentColor" viewBox="0 0 20 20">
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
      </svg>
    </button>
    
    <!-- Klaviyo Integration -->
    <script 
      type="text/javascript" 
      async 
      src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=T8pKVn">
    </script>
    <script type="text/javascript">
      !function(){if(!window.klaviyo){window._klOnsite=window._klOnsite||[];try{window.klaviyo=new Proxy({},{get:function(n,i){return"push"===i?function(){var n;(n=window._klOnsite).push.apply(n,arguments)}:function(){for(var n=arguments.length,o=new Array(n),w=0;w<n;w++)o[w]=arguments[w];var t="function"==typeof o[o.length-1]?o.pop():void 0,e=new Promise((function(n){window._klOnsite.push([i].concat(o,[function(i){t&&t(i),n(i)}]))}));return e}}})}catch(n){window.klaviyo=window.klaviyo||[],window.klaviyo.push=function(){var n;(n=window._klOnsite).push.apply(n,arguments)}}}}(); 
    </script>
    
    <!-- External Scripts -->
    <script src="../scripts/js/theme-toggle.js"></script>
    <script src="../scripts/js/performance-monitor.js"></script>
  </body>
</html>